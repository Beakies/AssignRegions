---
title: "Assign DFO Regions to WSDB records"
author: "LJ Feyrer, J. Stanistreet"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
```

This R Markdown document is made to interactively update and view the DFO region where sightings records occur prior to import in the WSDB using leaflet 

### REQUIREMENTS:

1. An input file - formatted Excel sheet with sighting coordinates that requires DFO region assignment and will be checked for land whales. The name of input file needs to be manually updated in this Rmarkdown script in the code block below --->

```{r input file, echo=T}

# Current xls file is specified in quotations here:
input_file <-"FWDtoGLFValidatedEntry2022.xlsx"

```
2. The correct folder structure and file names:
  - *input*: folder contains Excel sheet of sighting coordinates to check land and assign to regions. The name of this file needs to be specified by editting the rmarkdown file in the code block above. 

  - *output*: folder with .csv file containing results with REGION_CD and land variable data for each record. If you dont want an html map file and subfolder of html files for use outside of R, change save_map to FALSE
  
```{r save html map, echo=T}
save_map = TRUE
```

  - *shapefiles*: folder containing the following shapefiles:
  
      - DFO NAFO EEZ Regions: these are based on NAFO regions (2022), with Gulf/ QC 
        input and manually edited to remove overlap with land, extend to edge of Canada's EEZ, snap edges together, etc.
      - Canada: land area shapefile, sourced from National Atlas files on opengov.ca

```{r assign source region to output csv, echo=FALSE}
source("scripts/assignRegions_pt1.R")
```

### Confirm DFO REGION of the points on a map

```{r visualize region on map, echo=FALSE}
source("scripts/assignRegions_pt2.R")
WSmap1

saveWidget(WSmap1, file="WSDB_Regions.html")

```

### Region boundary spatial data sources:

|     MAR - From DFO Open Gov region shapefile + NAFO 
|     QC - From DFO Open Gov region shapefile + input from GULF 
|     NFLD - From DFO Open Gov region shapefile + NAFO 
|     GULF - From DFO Open Gov region shapefile + input from GULF 
|     AR - From DFO Open Gov region shapefile + NAFO 0A/0B
|     O&P - From DFO Open Gov land region shapefile
|     PAC - From DFO Open Gov land region shapefile & EEZ
|     OT - Other - anywhere outside Canada EEZ (e.g., St. Pierre)


### Visual check for errors if any of the points are on land. 
##### This will also be noted in the csv output in the variable field "land" for any records that overlap with the land polygon shapefile.

```{r visualize land whales on map, echo=FALSE}
WSmap2
```

